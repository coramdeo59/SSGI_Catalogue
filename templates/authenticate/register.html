{% extends 'base_auth.html' %}
{% load static %}
{%block title%}
Register
{% endblock %}
{% block content %}
<style>

    .card {
        background-color: rgba(255,255,255,0.8);
    }
</style>
<div class= "row" style="background-image: url({% static '/images/authbg.jpg' %});
background-size: cover;
background-position: center;
background-repeat: no-repeat;
min-height: 100vh;
color:black; font-weight:bold;">

    <div class="col-md-2"></div>

<div class="col-md-7 mt-5">

    <div class="wrapper">
                   
        <div class="text-center mt-4 name">
            REGISTER
        </div>
            
     <form class="p-3 mt-3" action="{%url 'register'%}" method="post">
        {% csrf_token %}
        {%include 'partials/_messages.html'%}
            <div class="form-field d-flex align-items-center">
                <label for="firstnameField" class="col-sm-3 col-form-label">First Name:</label>

                <div class="col-sm-6">
                    <input type="text" name="firstname" placeholder="First Name" id="firstnameField" class="form-control form-control-sm" value="{{fieldValues.firstname}}" />
                </div>
            </div> 
            <div class="invalid_feedback_firstname invalid-feedback" style="display:none">
            </div>
            

            <div class="form-field d-flex align-items-center">
                <label for="firstnameField" class="col-sm-3 col-form-label">MiddleName</label>

                 <div class="col-sm-6">
                    <input type="text" name="middlename" placeholder="Middle Name" id="middlenameField" class="form-control form-control-sm" value="{{fieldValues.middlename}}" />
                </div>
            </div>
            <div class="invalid_feedback_middlename invalid-feedback" style="display:none">
            </div>
            
            <div class="form-field d-flex align-items-center">
                <label for="firstnameField" class="col-sm-3 col-form-label">Last Name:</label>

                <div class="col-sm-6">
                    <input type="text" name="lastname" placeholder="Last Name" id="lastnameField" class="form-control form-control-sm" value="{{fieldValues.lastname}}"/>
                </div>
           </div>
           <div class="invalid_feedback_lastname invalid-feedback" style="display:none">
        </div>
           <div class="form-field d-flex align-items-center">
            <label for="firstnameField" class="col-sm-3 col-form-label">User Name:</label>

            <div class="col-sm-6">
                <input type="text" name="username" placeholder="User name" id="usernameField" class="form-control form-control-sm" value="{{fieldValues.username}}" />
            </div>
       </div>
       <div class="invalid_feedback_username invalid-feedback" style="display:none">
    </div>
       <div class="form-field d-flex align-items-center">
        <label for="firstnameField" class="col-sm-3 col-form-label">Email:</label>

        <div class="col-sm-6">
            <input type="email" name="email" placeholder="Email" id="emailField" class="form-control form-control-sm" value="{{fieldValues.email}}"/>
        </div>
   </div>
   <div class="emailFeedBackArea invalid-feedback" style="display:none">
</div>
   <div class="form-field d-flex align-items-center">
    <label for="firstnameField" class="col-sm-3 col-form-label">Password:</label>

    <div class="col-sm-6">
        <input type="password" name="password" placeholder="Password" id="passwordField" class="form-control form-control-sm"autocomplete="new-password" />
    </div><small class="float-right py-3 showPasswordToggle ml-9">SHOW</small>

</div>
<div class="passwordfeedbackarea invalid-feedback" style="display:none">
</div>
<div class="form-field d-flex align-items-center">
    <label for="firstnameField" class="col-sm-3 col-form-label">Confirm Password:</label>

    <div class="col-sm-6">
        <input type="password" name="confirmpassword" placeholder="Confirm Password" id="confirmpasswordField" class="form-control form-control-sm" autocomplete="new-password"  />
    </div>
</div>
<div class="confirmpasswordfeedbackarea invalid-feedback" style="display:none">
</div>
<div class="form-field d-flex align-items-center">
    <label for="firstnameField" class="col-sm-3 col-form-label">Country:</label>

    <div class="col-sm-6">

        <select name="country" placeholder=" country"  id="countryField" class="form-control form-control-sm">
            <option value="">Select a country</option>
        </select>
        
        <script>
            // Fetch the countries.json file
            fetch("{% static 'json/country.json' %}")
            .then(response => response.json())
            .then(data => {
                const countryField = document.getElementById("countryField");
                data.forEach(country => {
                const option = document.createElement("option");
                option.value = country.name;
                option.textContent = country.name;
                countryField.appendChild(option);
                });
                // Event listener for when a country is selected
            countryField.addEventListener('change', event => {
                const selectedCountryCode = countryField.value;
                console.log('Selected Country Code:', selectedCountryCode);
            });
            })
            .catch(error => {
                console.log("Error fetching countries:", error);
            });
        </script>   </div>
</div>
<div class="newconfirmpasswordfeedbackarea invalid-feedback" style="display:none">
</div>
<div class="form-field d-flex align-items-center">
    <label for="firstnameField" class="col-sm-3 col-form-label">Sector:</label>

    <div class="col-sm-6">
        <select name="sector" placeholder=" sector" id="sectorField" class="form-control form-control-sm">
            <option value="">In what sector do you work?</option>
        </select>
        
        <script>
            // Fetch the countries.json file
            fetch("{% static 'json/sector.json' %}")
            .then(response => response.json())
            .then(data => {
                const sectorField = document.getElementById("sectorField");
                data.forEach(sector => {
                const option = document.createElement("option");
                option.value = sector.name;
                option.textContent = sector.name;
                sectorField.appendChild(option);
                });
                sectorField.addEventListener('change', event => {
                    const selectedSectorCode = event.target.value;
                    console.log('Selected Sector Code:', selectedSectorCode);
                });
            })
            .catch(error => {
                console.log("Error fetching sectors:", error);
            });
        </script>   </div>
</div>
<div class="form-field d-flex align-items-center">
    <label for="firstnameField" class="col-sm-3 col-form-label"> Institute:</label>

    <div class="col-sm-6">

        <select name="institute"  placeholder=" institute"  id="instituteField" class="form-control form-control-sm">
            <option value="">Select institute</option>
        </select>
        
        <script>
            // Fetch the countries.json file
            fetch("{% static 'json/institute.json' %}")
            .then(response => response.json())
            .then(data => {
                const instituteField = document.getElementById("instituteField");
                data.forEach(institute => {
                const option = document.createElement("option");
                option.value = institute.name;
                option.textContent = institute.name;
                instituteField.appendChild(option);
                });
                instituteField.addEventListener('change', event => {
                    const selectedInstituteCode = event.target.value;
                    console.log('Selected Institute Code:', selectedInstituteCode);
                });
            })
            .catch(error => {
                console.log("Error fetching institutes:", error);
            });
        </script>   </div>
</div>
<div class="form-field d-flex align-items-center">
    <div class="col-sm-12">
        <div class="col-sm-12">
          <div class="row">
            <div class="col-md-4" id="column1"></div>
            <div class="col-md-4" id="column2"></div>
            <div class="col-md-4" id="column3"></div>
          </div>
        </div>
      </div>
      
      <script>
        // Fetch the usage_purposes.json file
        console.log("in script")
        fetch("{% static 'json/usage_purposes.json' %}")
          .then(response => response.json())
          .then(data => {
            const column1 = document.getElementById("column1");
            const column2 = document.getElementById("column2");
            const column3 = document.getElementById("column3");
            const checkboxArray = [];
      
            data.forEach((purpose, index) => {
              const checkbox = document.createElement("input");
              checkbox.type = "checkbox";
              checkbox.name = "usage_purpose";
              checkbox.value = purpose.name;
              checkbox.id = `purpose-${index}`;
      
              const label = document.createElement("label");
              label.htmlFor = `purpose-${index}`;
              label.textContent = purpose.name;
      
              const row = document.createElement("div");
              row.className = "row";
              const column = getColumn(index, column1, column2, column3);
              column.appendChild(row);
      
              const col = document.createElement("div");
              col.className = "col";
              col.appendChild(checkbox);
              col.appendChild(label);
              row.appendChild(col);
      
              checkbox.addEventListener("change", event => {
                const selectedPurposeCode = event.target.value;
                if (event.target.checked) {
                  checkboxArray.push(selectedPurposeCode);
                } else {
                  const index = checkboxArray.indexOf(selectedPurposeCode);
                  if (index !== -1) {
                    checkboxArray.splice(index, 1);
                  }
                }
                console.log("Selected Usage Purposes:", checkboxArray);
                fetch('/authenticate/validate-datapurpose', {
                  body: JSON.stringify({ usage_purposes: checkboxArray }),
                  method: "POST",
                })
                  .then(res => res.json())
                  .then(data => {
                    console.log("data", data);
                    if (data.usage_purpose_error) {
                      submitBtn.disabled = true;
                    } else {
                      submitBtn.removeAttribute("disabled");
                    }
                  });
      
              });
            });
          })
          .catch(error => {
            console.log("Error fetching usage purposes:", error);
          });
      
        function getColumn(index, column1, column2, column3) {
          const columnIndex = index % 3;
          if (columnIndex === 0) {
            return column1;
          } else if (columnIndex === 1) {
            return column2;
          } else {
            return column3;
          }
        }
      </script>              </div>
            

            <input type="submit" value="Register" class="btn btn-block btn-secondary submit-btn"  />
            
        </form>
        
        <p>Already have an account?</p>

        <form action="{%url 'login'%}" method="get">
            {% csrf_token %}
        <input type="submit" value="Login" class="btn btn-block btn-secondary submit-btn" />
        </form>
      </div> 
        
    </div>









           



        </div>
    </div>
</div>

<div class="col-md-3"></div>
</div>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Poppins', sans-serif;
    }
    
    body {
        background: #ecf0f3;
    }
    
    .wrapper {
        max-width: 700px;
        min-height: 500px;
        margin: 80px auto;
        padding: 40px 30px 30px 30px;
        background-color: #ecf0f3;
        border-radius: 7px;
        margin-top:10px;
    }
    
    .logo {
        width: 80px;
        margin: auto;
    }
    
    .logo img {
        width: 100%;
        height: 80px;
        object-fit: cover;
        border-radius: 50%;
        box-shadow: 0px 0px 3px #5f5f5f,
            0px 0px 0px 5px #ecf0f3,
            8px 8px 15px #a7aaa7,
            -8px -8px 15px #fff;
    }
    
    .wrapper .name {
        font-weight: 600;
        font-size: 1.4rem;
        letter-spacing: 1.3px;
        padding-left: 10px;
        color: #555;
    }
    
    .wrapper .form-field input {
        width: 100%;
        display: block;
        border: none;
        outline: none;
        background: none;
        font-size: 1.2rem;
        color: #666;
        padding: 10px 15px 10px 10px;
        /* border: 1px solid red; */
    }
    
    .wrapper .form-field {
        padding-left: 10px;
        margin-bottom: 20px;
        border-radius: 10px;
        box-shadow: inset 5px 5px 5px #cbced1, inset -5px -5px 5px #fff;
    }
    
    .wrapper .form-field .fas {
        color: #555;
    }
    
    .wrapper .btn {
        box-shadow: none;
        width: 100%;
        height: 40px;
        background-color: #212529;
        color: #fff;
        border-radius: 25px;
        box-shadow: 3px 3px 3px #b1b1b1,
            -3px -3px 3px #fff;
        letter-spacing: 1.3px;
    }
    
    .wrapper .btn:hover {
        background-color: #000;
    }
    
    .wrapper a {
        text-decoration: none;
        font-size: 0.8rem;
        color: #212529;
    }
    
    .wrapper a:hover {
        color: #000;
    }
    
    @media(max-width: 380px) {
        .wrapper {
            margin: 30px 20px;
            padding: 40px 15px 15px 15px;
        }
    }</style>
<script src="{%static 'js/register.js'%}"></script>

{% endblock content %}
